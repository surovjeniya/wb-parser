version: '3.7'

networks:
  infra:
    name: $INFRA_NETWORK
    driver: bridge


services:
  nginx-service:
    image: $INFRA_NGINX_IMAGE
    container_name: $INFRA_NGINX_APP
    build: 
      context: ../nginx
      dockerfile: Dockerfile
    ports:
      - "${INFRA_NGINX_PORT}:${INFRA_NGINX_PORT}"
    restart: unless-stopped
    networks:
     - infra
    depends_on:
      - parser-api-service

  parser-api-service:
    image: $INFRA_PARSER_API_IMAGE
    container_name: $INFRA_PARSER_API_APP
    build: 
      context: ../app
      dockerfile: Dockerfile
      target: production
    restart: unless-stopped
    environment:
      PORT: $INFRA_PARSER_API_PORT
    networks:
     - infra
